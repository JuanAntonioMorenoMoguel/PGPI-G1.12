<!DOCTYPE html>
{% load static %}

<html lang="es">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="{% static 'images/logo.ico' %}">
    <title>OPOSCHEDULE</title>
    <link rel="stylesheet" href="{% static 'css/estilosbase.css' %}">
    <!-- CSS de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- JavaScript de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>

    {% block title %}{% endblock title %}
    {% block extra_css %}{% endblock extra_css %}

    <style>
        /* Barra de navegaci칩n */
        .navbar {
            background-color: #ffffff;
            border-bottom: 1px solid #eaeaea;
            z-index: 1030;
            padding: 10px 20px;
        }

        /* Estilos de los elementos de la barra */
        .navbar .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 10px; /* Espaciado entre logo y texto */
        }

        .navbar-menu {
            display: flex;
            align-items: center;
            gap: 15px; /* Espaciado entre elementos del men칰 */
        }

        .navbar-menu form {
            display: flex;
            align-items: center;
            gap: 5px; /* Espaciado en el formulario */
        }

        .nav-link {
            color: #6c757d;
            text-decoration: none;
        }

        .nav-link:hover {
            color: #0056b3;
        }

        /* Ajustar el contenido de las p치ginas */
        body {
            padding-top: 70px; /* Para evitar que el contenido se superponga con la barra */
        }
    </style>
</head>

<body>
    <!-- Barra de navegaci칩n -->
    <nav class="navbar fixed-top">
        <!-- Pon que no tenga margen a la izquierda-->
        <div class="container-fluid navbar-container" style="margin-left: 0;">
            <!-- Logo y t칤tulo -->
            <div class="navbar-logo">
                <a href="{% url 'index' %}">
                    <img src="{% static 'images/logo.png' %}" alt="Logo" style="width: 25px; height: 25px;">
                </a>
                <a href="{% url 'index' %}" class="navbar-brand mb-0 h1" style="color: green;">OPOSCHEDULE</a>
            </div>

            <!-- Men칰 de navegaci칩n -->
            <div class="navbar-menu">
                {% if user.is_authenticated %}
                    {% if user.is_staff %}
                        <!-- Opciones para staff (si aplica) -->
                        <a class="nav-link" href="{% url 'admin_usuarios' %}">Usuarios</a>
                        <a class="nav-link" href="{% url 'lista_cursos' %}">Cursos</a>
                        <a class="nav-link" href="{% url 'admin_horarios' %}">Horarios</a>
                        <a class="nav-link" href="{% url 'admin_recibos' %}">Recibos</a>
                    {% elif not user.is_superuser %}
                        <a class="nav-link" href="{% url 'mis_cursos' %}">Mis Cursos</a>
                        <a class="nav-link" href="{% url 'mis_recibos' %}">Mis Recibos</a>
                        <a class="nav-link" href="{% url 'lista_cursos' %}">Cursos Disponibles</a>
                        <a href="{% url 'ver_carrito' %}" class="nav-link d-flex align-items-center">
                            游 Ver Cesta <span id="carrito-cantidad" class="ms-1">0</span>
                        </a>
                    {% endif %}
                    <a class="nav-link" href="{% url 'perfil' %}">{{ user.email }}</a>
                    <a class="nav-link" href="{% url 'contacto' %}">Cont치ctanos</a>
                    <form action="{% url 'cerrar_sesion' %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link nav-link p-0" style="text-decoration: none;">Cerrar Sesi칩n</button>
                    </form>
                {% else %}
                    <a href="{% url 'inicio_sesion' %}" class="btn btn-secondary">Acceso</a>
                    <a class="nav-link" href="{% url 'contacto' %}">Cont치ctanos</a>
                    <a class="nav-link" href="{% url 'lista_cursos' %}">Cursos Disponibles</a>
                    <a href="{% url 'ver_carrito_no_auth' %}" class="nav-link d-flex align-items-center">
                        游 Ver Cesta <span id="carrito-cantidad" class="ms-1">0</span>
                    </a>
                {% endif %}
                

                <!-- Formulario para buscar recibo -->
                {% if not user.is_superuser %}
                    {% if user.is_authenticated %}
                        <!-- Buscar recibo para usuarios autenticados -->
                        <form action="{% url 'ver_recibo' %}" method="get" class="d-flex align-items-center">
                            <input type="text" name="codigo_referencia" placeholder="Buscar recibo por ID" class="form-control form-control-sm" style="width: 200px;">
                            <button type="submit" class="btn btn-primary btn-sm ms-2">Buscar Recibo</button>
                        </form>
                    {% else %}
                        <!-- Buscar recibo para usuarios no autenticados -->
                        <form action="{% url 'ver_recibo_no_auth' %}" method="get" class="d-flex align-items-center">
                            <input type="text" name="codigo_referencia" placeholder="Buscar recibo por ID" class="form-control form-control-sm" style="width: 200px;">
                            <button type="submit" class="btn btn-primary btn-sm ms-2">Buscar Recibo</button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </nav>

    {% block content %}{% endblock content %}
</body>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/carrito-cantidad/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            const carritoCantidad = document.getElementById('carrito-cantidad');
            if (carritoCantidad) {
                carritoCantidad.textContent = data.carrito_cantidad;
            }
        })
        .catch(error => console.error('Error al inicializar el carrito:', error));
    });
</script>
</html>
