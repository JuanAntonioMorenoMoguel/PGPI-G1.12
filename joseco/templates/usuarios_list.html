{% extends "base.html" %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/table.css' %}">
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #ccc;
        width: 400px;
        text-align: center;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .btn-secundario {
        background-color: #6c757d;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .btn-secundario:hover {
        background-color: #5a6268;
    }
</style>
{% endblock extra_css %}

{% block content %}
<h1 class="titulo text-center" style="margin-top: 60px;">Lista de Usuarios</h1>

<div class="table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellidos</th>
                <th>Email</th>
                <th>¿Es Superusuario?</th>
                <th>Último Login</th>
                <th>¿Activo?</th>
                <th>Fecha de Creación</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <td>{{ usuario.id }}</td>
                <td>{{ usuario.first_name }}</td>
                <td>{{ usuario.last_name }}</td>
                <td>{{ usuario.email }}</td>
                <td>{{ usuario.is_superuser|yesno:"Sí,No" }}</td>
                <td>{{ usuario.last_login|date:"d/m/Y H:i" }}</td>
                <td>{{ usuario.is_active|yesno:"Sí,No" }}</td>
                <td>{{ usuario.date_joined|date:"d/m/Y H:i" }}</td>
                <td>
                    <a href="{% url 'editar_usuario' usuario.id %}" class="btn btn-azul">Editar</a>
                    <button type="button" class="btn btn-rojo eliminar-btn" data-id="{{ usuario.id }}" data-nombre="{{ usuario.first_name }} {{ usuario.last_name }}">
                        Eliminar
                    </button>
                    <a href="{% url 'recibos_usuario' usuario.id %}" class="btn btn-azul">Ver Recibos</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="no-usuarios">No hay usuarios disponibles.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px; text-align: center;">
        <a href="{% url 'crear_usuario' %}" class="btn btn-verde">+ Crear Usuario</a>
    </div>
</div>

<!-- Modal para confirmar eliminación -->
<div id="eliminarModal" class="modal">
    <div class="modal-content">
        <p id="modalMessage">¿Está seguro de que desea eliminar este usuario?</p>
        <form id="eliminarForm" method="post">
            {% csrf_token %}
            <div style="display: flex; justify-content: center; gap: 10px;">
                <button type="submit" class="btn btn-rojo">Eliminar</button>
                <button type="button" id="cancelModal" class="btn btn-secundario">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const eliminarModal = document.getElementById('eliminarModal');
        const eliminarForm = document.getElementById('eliminarForm');
        const cancelModal = document.getElementById('cancelModal');
        const modalMessage = document.getElementById('modalMessage');

        // Manejar clic en los botones de eliminar
        document.querySelectorAll('.eliminar-btn').forEach(button => {
            button.addEventListener('click', () => {
                const usuarioId = button.dataset.id;
                const usuarioNombre = button.dataset.nombre;

                // Configurar mensaje y URL en el formulario
                modalMessage.textContent = `¿Está seguro de que desea eliminar al usuario "${usuarioNombre}"?`;
                eliminarForm.action = `/admin/usuarios/${usuarioId}/eliminar/`;

                // Mostrar el modal
                eliminarModal.style.display = 'block';
            });
        });

        // Cancelar y cerrar el modal
        cancelModal.addEventListener('click', () => {
            eliminarModal.style.display = 'none';
        });

        // Cerrar el modal al hacer clic fuera del contenido
        window.addEventListener('click', (event) => {
            if (event.target === eliminarModal) {
                eliminarModal.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}
